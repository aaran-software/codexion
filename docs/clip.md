unit+integration tests based on this flow.